<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Doekoes</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f9f9f9;
      margin: 0;
      padding: 1em;
      max-width: 600px;
      margin: auto;
    }
    h1 { text-align: center; color: #2c3e50; }
    p.notice {
      font-size: 0.9em;
      color: #888;
      text-align: center;
      margin-bottom: 2em;
    }
    .goal-card {
      background: white;
      padding: 1em;
      margin-bottom: 1em;
      border-radius: 8px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
    }
    .progress {
      background: #eee;
      border-radius: 4px;
      overflow: hidden;
      height: 20px;
      margin: 0.5em 0;
    }
    .progress-bar {
      background: #2ecc71;
      height: 100%;
    }
    button, input[type="text"], input[type="number"], select {
      padding: 0.5em;
      margin-top: 0.5em;
      width: 100%;
      box-sizing: border-box;
      font-size: 1em;
    }
    .hidden { display: none; }
    .modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: white;
      padding: 1em;
      border-radius: 6px;
      max-width: 90%;
      width: 400px;
    }
  </style>
</head>
<body>

<h1>Doekoes</h1>
<p class="notice">Testsite: gegevens worden alleen lokaal op je telefoon opgeslagen. Geen back-up.</p>

<div id="goals-list"></div>

<button onclick="showGoalModal()">Nieuw doel</button>

<div id="goal-modal" class="modal hidden">
  <div class="modal-content">
    <h2>Nieuw doel</h2>
    <input type="text" id="goal-name" placeholder="Naam van het doel" />
    <input type="number" id="goal-amount" placeholder="Totaalbedrag nodig" />
    <input type="text" id="goal-deadline" placeholder="Deadline (optioneel)" />
    <button onclick="addGoal()">Opslaan</button>
  </div>
</div>

<div id="earn-modal" class="modal hidden">
  <div class="modal-content">
    <h2>Geld verdiend</h2>
    <select id="earn-method">
      <option>Spullen verkocht</option>
      <option>Lekkers gemaakt en verkocht</option>
      <option>Lege flessen opgehaald</option>
      <option>Auto gewassen</option>
      <option>Boodschappen gedaan</option>
      <option value="custom">Anders...</option>
    </select>
    <input type="text" id="custom-method" placeholder="Eigen omschrijving" class="hidden" />
    <input type="number" id="earn-amount" placeholder="Hoeveel verdiend?" />
    <button onclick="addEarning()">Toevoegen</button>
  </div>
</div>

<script>
let goals = JSON.parse(localStorage.getItem("doekoes_goals") || "[]");
let user = localStorage.getItem("doekoes_user");
let selectedGoalIndex = null;

const compliments = [
  "Lekker bezig!", "Dat tikt lekker aan!", "Money, money, money!", "Jij bent echt een spaarkoning(in)!",
  "Sparend de wereld rond!", "Zeg, ben jij stiekem een miljonair in wording?", "Bam! Zo doe je dat.",
  "Je bankrekening glimlacht.", "Spaardoel komt eraan!", "Je bent echt op dreef!", "Dat doel gaat eraan geloven.",
  "Je hebt goud in handen.", "Wie heeft er een geldboom nodig als jij spaart?", "Je portemonnee is trots op je.",
  "Wat een cash flow!", "Je zou economie moeten geven!", "Miljoenencampagne? Jij bent al halverwege!",
  "Elke euro telt — en jij telt hard door!", "Je spaart sneller dan je schaduw.", "Doel in zicht? Jij hebt het al bijna te pakken!",
  "Is dit magie? Nee, gewoon spaartalent.", "Zet hem op, geldheld!", "Zelfs je spaarpot applaudisseert.",
  "Money moves maken, dat kan jij!", "Kassa! 🛒", "Jouw doel bibbert al van angst!", "Geld verdienen met stijl.",
  "Spaarkampioen van de maand!", "Doekoes-machine geactiveerd!", "Je bent on fire 🔥", "Chapeau voor je cashflow!",
  "Die euro’s weten niet wat ze meemaken.", "Je maakt geld verdienen leuk!", "Was sparen maar een sport — jij won goud!",
  "Jouw inzet is bankwaardig!", "De euro’s vliegen je portemonnee in.", "Alsof je geld magnetisch aantrekt!",
  "Je doel komt dichterbij, dollarbaas!", "Je portemonnee wordt al zwaarder.", "Toppie, spaarheld!",
  "Cash is king — en jij bent de koning(in)!", "Geef jezelf een high five 🖐️", "Ben jij een spaarninja?",
  "Die euro’s maken een polonaise!", "Zelfs een varken wil in jouw spaarpot wonen.",
  "Je bankrekening voelt zich gezegend.", "Met jou komt dat doel er wel!", "Serieus, dit is indrukwekkend.",
  "Geld verdienen + glimlachen = jij!", "Winstgevend én charmant!", "Die doelen krijgen geen schijn van kans!",
  "Is dit nog sparen of al magie?", "Jij verdient een applaus én een koekje 🍪", "Spaardoel? Meer een spaardoelwit!",
  "Je geld groeit als kool!", "Respect voor je spaardiscipline!", "Waanzinnig goed bezig!",
  "Wat een geldheldendaad!", "Cashqueen / Cashking in actie!", "Sparen als een baas!"
];
let complimentIndex = parseInt(localStorage.getItem("doekoes_complimentIndex") || "0");

if (!user) {
  user = prompt("Wat is je naam?");
  if (user) localStorage.setItem("doekoes_user", user);
}

function saveGoals() {
  localStorage.setItem("doekoes_goals", JSON.stringify(goals));
}

function showGoals() {
  const list = document.getElementById("goals-list");
  list.innerHTML = "";
  goals.forEach((goal, index) => {
    const div = document.createElement("div");
    div.className = "goal-card";
    const earned = goal.earnings.reduce((sum, e) => sum + e.amount, 0);
    const remaining = Math.max(goal.amount - earned, 0);
    const percent = Math.min(100, Math.round((earned / goal.amount) * 100));
    div.innerHTML = `
      <h3>${goal.name}</h3>
      <div class="progress"><div class="progress-bar" style="width:${percent}%"></div></div>
      <p>Resterend: €${remaining.toFixed(2)} van €${goal.amount}</p>
      ${goal.deadline ? `<p>Deadline: ${goal.deadline}</p>` : ""}
      <button onclick="openEarnModal(${index})">Voeg geld toe</button>
      <button onclick="editGoal(${index})">Bewerk</button>
      <button onclick="deleteGoal(${index})" style="color:red">Verwijder</button>
    `;
    list.appendChild(div);
  });
}

function showGoalModal() {
  selectedGoalIndex = null;
  document.getElementById("goal-name").value = "";
  document.getElementById("goal-amount").value = "";
  document.getElementById("goal-deadline").value = "";
  document.getElementById("goal-modal").classList.remove("hidden");
}

function addGoal() {
  const name = document.getElementById("goal-name").value.trim();
  const amount = parseFloat(document.getElementById("goal-amount").value);
  const deadline = document.getElementById("goal-deadline").value.trim();
  if (!name || isNaN(amount)) return alert("Voer een geldige naam en bedrag in.");
  if (selectedGoalIndex === null) {
    goals.push({ name, amount, deadline, earnings: [] });
  } else {
    goals[selectedGoalIndex].name = name;
    goals[selectedGoalIndex].amount = amount;
    goals[selectedGoalIndex].deadline = deadline;
  }
  saveGoals();
  showGoals();
  document.getElementById("goal-modal").classList.add("hidden");
}

function editGoal(index) {
  selectedGoalIndex = index;
  const g = goals[index];
  document.getElementById("goal-name").value = g.name;
  document.getElementById("goal-amount").value = g.amount;
  document.getElementById("goal-deadline").value = g.deadline;
  document.getElementById("goal-modal").classList.remove("hidden");
}

function deleteGoal(index) {
  const goal = goals[index];
  if (confirm(`Weet je zeker dat je "${goal.name}" wilt verwijderen?`)) {
    goals.splice(index, 1);
    saveGoals();
    showGoals();
  }
}

function openEarnModal(index) {
  selectedGoalIndex = index;
  document.getElementById("earn-method").value = "Spullen verkocht";
  document.getElementById("custom-method").classList.add("hidden");
  document.getElementById("earn-amount").value = "";
  document.getElementById("earn-modal").classList.remove("hidden");
}

document.getElementById("earn-method").addEventListener("change", () => {
  document.getElementById("custom-method").classList.toggle(
    "hidden",
    document.getElementById("earn-method").value !== "custom"
  );
});

function addEarning() {
  const methodSel = document.getElementById("earn-method").value;
  const method = methodSel === "custom"
    ? document.getElementById("custom-method").value.trim()
    : methodSel;
  const amount = parseFloat(document.getElementById("earn-amount").value);
  if (!method || isNaN(amount)) return alert("Vul een geldige methode en bedrag in.");

  const goal = goals[selectedGoalIndex];
  goal.earnings.push({ method, amount });
  saveGoals();
  showGoals();
  document.getElementById("earn-modal").classList.add("hidden");

  alert(getCompliment(goal));
}

function getCompliment(goal) {
  const compliment = compliments[complimentIndex % compliments.length]
    .replace("!", `, ${Math.random() < 0.5 ? user : ""}!`);
  complimentIndex++;
  localStorage.setItem("doekoes_complimentIndex", complimentIndex);
  const totalEarned = goal.earnings.reduce((sum, e) => sum + e.amount, 0);
  if (totalEarned >= goal.amount) {
    return `WOOOW! Je hebt je doel "${goal.name}" gehaald! 🎉🎉 Geweldig gedaan${Math.random() < 0.5 ? ', ' + user : ''}!`;
  }
  return compliment;
}

showGoals();
</script>

</body>
</html>
